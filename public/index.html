<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snake</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://cdn.socket.io/socket.io-1.3.7.js" ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
</head>
<body>

    <input id="snake1" onclick="check()" type="radio" name="snake" value="snake1"><span id="sk1">Snake_1</span><br>
    <input id="snake2" onclick="check()" type="radio" name="snake" value="snake2"><span id="sk2">Snake_2</span>

    <div id="grid">grid panel</div>
    <span id="score">Score</span>
    <script>

        var  keystate = {};
        var ID;

        function check() {
            if(document.getElementById('snake1').checked){
                console.log('snake_1 has been selected!');
                ID = 1;
                socket.emit('gameStarted', true);
                socket.emit('snakeSelected', ID);
            }else if(document.getElementById('snake2').checked){
                console.log('snake_2 has been selected!');
                ID = 2;
                socket.emit('gameStarted', true);
                socket.emit('snakeSelected', ID);
            }
        }

        document.addEventListener("keydown", function(evt) {
            keystate[evt.keyCode] = true;
            socket.emit('update', evt.keyCode, ID);
            console.log(evt.keyCode);
        });
        document.addEventListener("keyup", function(evt) {
            delete keystate[evt.keyCode];
        });


//        /** constants **/
//
//        /** donar una id a cada serp de cada jugador:
//         * jugador1: SNAKE = 1
//         * jugador2: SNAKE = 2
//         * **/
//        var
//                ROWS = 5, COLS = 10, SNAKE = 0, FRUIT = 8, LEFT  = 0, UP = 1, RIGHT = 2, DOWN = 3,
//                KEY_LEFT = 37, KEY_UP = 38, KEY_RIGHT = 39, KEY_DOWN  = 40, keystate = {}, SCORE_1 = 0, GAME_STARTED = false;
//
//        /** ------- Objectes ------- **/
//
//        grid = {
//            _grid: [],
//            init: function () {
//                this._grid = [];
//                for (var x = 0; x < ROWS; x++) {
//                    this._grid.push([]);
//                    for (var y = 0; y < COLS; y++) {
//                        this._grid[x].push(0);
//                    }
//                }
//            },
//            set: function(val, x, y) {
//                this._grid[x][y] = val;
//            },
//            get: function(x, y) {
//                return this._grid[x][y];
//            }
//        };
//
//        snake = {
//            direction: null, /* number */
//            last: null,		 /* Object, pointer to the last element in the queue */
//            _queue: null,	 /* Array */
//
//            /**
//             * Clears the queue and sets the start position and direction
//             *
//             * @param  {number} d start direction
//             * @param  {number} x start x-coordinate
//             * @param  {number} y start y-coordinate
//             */
//            init: function(d, x, y) {
//                this.direction = d;
//                this._queue = [];
//                this.insert(x, y);
//            },
//            /**
//             * Adds an element to the queue
//             *
//             * @param  {number} x x-coordinate
//             * @param  {number} y y-coordinate
//             */
//            insert: function(x, y) {
//                this._queue.unshift( {x:x, y:y} );
//                this.last = this._queue[0];
//            },
//            /**
//             * Removes and returns the first element in the queue.
//             *
//             * @return {Object} the first element
//             */
//            remove: function() {
//                //returns the last element
//                return this._queue.pop();
//            }
//        };
//
//        /** ------- Starts game ------- **/
//
//        document.addEventListener("keydown", function(evt) {
//            keystate[evt.keyCode] = true;
//            update();
//        });
//        document.addEventListener("keyup", function(evt) {
//            delete keystate[evt.keyCode];
//        });
//
//
//        /** ------- Resets and inits game objects ------- **/
//
//        /** ------- Set a food id at a random free cell in the grid ------- **/
//        function setFood() {
//            var empty = [];
//            // iterate through the grid and find all empty cells
//            for (var x=0; x < ROWS; x++) {
//                for (var y=0; y < COLS; y++) {
//                    if (grid.get(x, y) === 0) {
//                        empty.push({x:x, y:y});
//                    }
//                }
//            }
//            // chooses a random cell
//            var randpos = empty[Math.round(Math.random()*(empty.length - 1))];
//            grid.set(FRUIT, randpos.x, randpos.y);
//        }
//
//        function init() {
//
//            if(!GAME_STARTED){
//
//                grid.init();
//                grid.set(FRUIT, 3, 3);
//                var sp_1 = {x:0, y:0};      //snake start point for snake_1
//                snake.init(UP, sp_1.x, sp_1.y);                     //initialize snake queue with start point
//            }
//
//            grid.set(1, sp_1.x, sp_1.y);                    //show the snake position on the  grid
//
//            SCORE_1 = 0;
//            document.getElementById('score').innerHTML = 'Score: ' + SCORE_1.toString();
//            document.getElementById("grid").innerHTML = grid._grid.join(" ");
//        }
//
//        /** ------- Updates the game logic ------- **/
//        function update() {
//            // change direction of the snake depending on which keys are pressed
//            if (keystate[KEY_LEFT]) {
//                snake.direction = LEFT;
//            }
//            if (keystate[KEY_UP]) {
//                snake.direction = UP;
//            }
//            if (keystate[KEY_RIGHT]) {
//                snake.direction = RIGHT;
//            }
//            if (keystate[KEY_DOWN]) {
//                snake.direction = DOWN;
//            }
//
//            // pop the last element from the snake queue (the head)
//            var nx = snake.last.x;
//            var ny = snake.last.y;
//
//            // updates the position depending on the snake direction
//            switch (snake.direction) {
//                case LEFT:
//                    ny--;
//                    break;
//                case UP:
//                    nx--;       //CAMBIAT ELS ORDRES X - Y !!!
//                    break;
//                case RIGHT:
//                    ny++;
//                    break;
//                case DOWN:
//                    nx++;
//                    break;
//            }
//
//            // checks all gameover conditions
//            if (0 > nx || nx > ROWS - 1  || 0 > ny || ny > COLS - 1 || grid.get(nx, ny) === SNAKE) {
//                return init();
//            }
//
//            // check wheter the new position are on the fruit item
//            if (grid.get(nx, ny) === FRUIT) {
//                SCORE_1++;
//                document.getElementById('score').innerHTML = 'Score: ' + SCORE_1.toString();
//                setFood();      //sets a new fruit position
//            } else {
//                // take out the first item from the snake queue i.e the tail and remove it from grid
//                var tail = snake.remove();
//                grid.set(0, tail.x, tail.y);
//            }
//
//            // add a snake at the new position and append it to the snake queue
//            grid.set(SNAKE, nx, ny);
//            snake.insert(nx, ny);
//
//            socket.emit('newGrid', grid._grid);
//
////            document.getElementById("grid").innerHTML = grid._grid.join(" ");
////            console.log('nx: '+ nx + ' - ' + 'ny: ' + ny);
////            console.log('snake.direction: '+snake.direction);
//        }
//
//        init();

        /** ======= Client Socket.io ======= **/
        /**
         *  Connect the client to the server with sockets
         *  which is running on http://localhost:3000
         *  and listening to 'messages' events
         */

        var socket = io.connect('http://localhost:3000');

        socket.on('serverGrid', function (grid) {     //data contains the messages array send by the server
            document.getElementById("grid").innerHTML = grid;
            console.log(typeof(grid));
        });

        socket.on('snakeChecked', function (id) {
            var snakeSelected = 'snake'+id;
            console.log(snakeSelected);
            console.log('snake selected: ' + id);
            $('#'+snakeSelected).hide(1000);
            $('#sk'+id).hide(1500);
        });

    </script>
</body>
</html>